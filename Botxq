import discord
from discord.ext import commands
import os
import json
from dotenv import load_dotenv  
load_dotenv()
tokenbot = os.getenv("TOKENBOT") 
OWNER_ID = 1067374135220649985

intents = discord.Intents.default()
intents.message_content = True
intents.members = True
bot = commands.Bot(command_prefix='!', intents=intents)
chat_channel_id = None

def load_admins():
    if not os.path.exists("admins.json"):
        with open("admins.json", "w") as f:
            json.dump({"admins": [OWNER_ID]}, f, indent=4)
    with open("admins.json", "r") as f:
        return json.load(f)["admins"]

def save_admins(admins):
    with open("admins.json", "w") as f:
        json.dump({"admins": admins}, f, indent=4)

admins = load_admins()

@bot.event
async def on_ready():
    print(f'Bot {bot.user} Ä‘Ã£ online rá»“i ğŸ˜')
    try:
        synced = await bot.tree.sync()
        print(f"ÄÃ£ sync {len(synced)} lá»‡nh.")
    except Exception as e:
        print(f"Lá»—i sync: {e}")

@bot.tree.command(name="addadmin", description="ThÃªm 1 admin má»›i (chá»‰ Äáº¡t dÃ¹ng Ä‘Æ°á»£c)")
async def add_admin(interaction: discord.Interaction, user_id: int):
    if interaction.user.id != OWNER_ID:
        await interaction.response.send_message("âŒ Báº¡n khÃ´ng cÃ³ quyá»n dÃ¹ng lá»‡nh nÃ y!", ephemeral=True)
        return
    if user_id in admins:
        await interaction.response.send_message("âš ï¸ NgÆ°á»i nÃ y Ä‘Ã£ lÃ  admin rá»“i!", ephemeral=True)
    else:
        admins.append(user_id)
        save_admins(admins)
        await interaction.response.send_message(f"âœ… ÄÃ£ thÃªm <@{user_id}> lÃ m admin!", ephemeral=False)

@bot.tree.command(name="removeadmin", description="XÃ³a 1 admin (chá»‰ Äáº¡t dÃ¹ng Ä‘Æ°á»£c)")
async def remove_admin(interaction: discord.Interaction, user_id: int):
    if interaction.user.id != OWNER_ID:
        await interaction.response.send_message("âŒ Báº¡n khÃ´ng cÃ³ quyá»n dÃ¹ng lá»‡nh nÃ y!", ephemeral=True)
        return
    if user_id not in admins:
        await interaction.response.send_message("âš ï¸ NgÆ°á»i nÃ y khÃ´ng pháº£i admin!", ephemeral=True)
    else:
        admins.remove(user_id)
        save_admins(admins)
        await interaction.response.send_message(f"ğŸ—‘ï¸ ÄÃ£ xÃ³a <@{user_id}> khá»i admin!", ephemeral=False)

@bot.tree.command(name="text", description="Nháº­p Ä‘á»ƒ XuÃ¢n Quá»³nh gá»­i vÃ o chat")
async def text(interaction: discord.Interaction, inra: str):
    if interaction.user.id not in admins:
        await interaction.response.send_message("âŒ báº¡n lÃ m gÃ¬ cÃ³ quyá»n Ä‘á»ƒ gá»­i tin nháº¯n nÃ y!", ephemeral=True)
    else:
        await interaction.response.send_message(f"âœ… [{inra}] Ä‘Ã£ Ä‘Æ°á»£c gá»­i", ephemeral=True)
        await interaction.channel.send(inra)

bot.run(tokenbot)
